<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Mask Detection</title>
        <link rel="stylesheet" href="style.css">
        <!-- <style>
            body {
    margin: 0;
    padding: 0;
    font-family: 'Roboto', sans-serif;
    background-color: #f4f4f4;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    color: #333;
}

/* Header */
header {
    background-color: #2c3e50;
    color: white;
    text-align: center;
    padding: 20px;
    font-size: 24px;
    font-weight: 500;
}

/* Main Layout */
main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

/* Canvas & Video Container */
.video-container {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 20px;
}

/* Debug Box */
.debug-box {
    width: 80%;
    max-width: 640px;
    background-color: white;
    padding: 15px;
    margin-top: 10px;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    font-size: 14px;
    overflow-y: auto;
    max-height: 150px;
}

/* Footer */
footer {
    background-color: #2c3e50;
    color: white;
    text-align: center;
    padding: 10px;
    font-size: 14px;
}
        </style> -->
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;500&display=swap" rel="stylesheet">
    </head>
<body>
    <header>
        <h1>Mask Detection System</h1>
    </header>
    <main>
        <div class="video-container">
            <canvas id="canvas" width="640" height="480"></canvas>
        </div>
        <div id="debug" class="debug-box"></div>
    </main>
    <footer>
        <p>Powered by AI | Stay Safe, Stay Healthy</p>
    </footer>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const debugDiv = document.getElementById('debug');

        // Hidden video element for capturing frames
        const video = document.createElement('video');
        video.style.display = 'none';
        document.body.appendChild(video);

        // Access the camera
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
                video.play();
            })
            .catch(err => {
                console.error("Error accessing the camera", err);
                debugDiv.innerHTML += `<p>Error accessing the camera: ${err.message}</p>`;
            });

        function processFrame() {
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = canvas.toDataURL('image/jpeg');

            axios.post('/process_image', { image: imageData })
                .then(response => {
                    const results = response.data;
                    debugDiv.innerHTML = `<p>Received results: ${JSON.stringify(results)}</p>`;
                    drawResults(results);
                })
                .catch(error => {
                    console.error("Error processing the image", error);
                    debugDiv.innerHTML += `<p>Error processing the image: ${error.message}</p>`;
                });
        }

        function drawResults(results) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            results.forEach(result => {
                const [x, y, w, h] = result.bbox;
                const color = result.class === 'Masked' ? 'green' : 'red';

                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.strokeRect(x, y, w, h);

                ctx.fillStyle = color;
                ctx.font = '16px Arial';
                ctx.fillText(`${result.class}: ${result.confidence.toFixed(2)}`, x, y - 5);
            });
        }

        // Process a frame every 500ms
        setInterval(processFrame, 500);
    </script>
</body>
</html>
